<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Video.js — Responsive Player (Auto Detect)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <!-- Video.js core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js@8/dist/video-js.min.css">

  <style>
    :root {
      color-scheme: dark;
      --bg: #0b0b0c;
      --panel: #121214;
      --border: #2a2a2e;
      --text: #e9e9ec;
      --muted: #b9bbc6;
      --radius: 12px;
      --pad: clamp(12px, 2.2vw, 20px);
      --gap: clamp(8px, 1.5vw, 12px);
      --font: clamp(14px, 1.1vw + 10px, 16px);
      --h1: clamp(18px, 2.5vw + 8px, 28px);
      --touch: 44px; /* min touch target */
      --maxw: 960px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 400 var(--font)/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    header { padding: var(--pad) 0; }
    .wrap { width: min(100% - 2*var(--pad), var(--maxw)); margin: 0 auto; }

    h1 { margin: 0 0 6px; font-size: var(--h1); font-weight: 650; letter-spacing: .2px; }
    small.note { color: var(--muted); display:block; }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: calc(var(--radius) + 2px);
      padding: var(--pad);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    /* URL bar */
    .urlbar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: var(--gap);
      align-items: center;
      margin: var(--gap) 0 var(--pad);
    }
    input[type="text"] {
      min-height: var(--touch);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: #151517;
      color: var(--text);
      padding: 10px 12px;
      outline: none;
      width: 100%;
    }
    button, select {
      min-height: var(--touch);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: #151517;
      color: var(--text);
      padding: 10px 14px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover { background:#1c1c20; }

    /* Player container */
    .player-shell {
      border-radius: calc(var(--radius) + 4px);
      overflow: hidden;
    }
    .vjs-theme {
      border-radius: calc(var(--radius) + 4px);
      overflow: hidden;
      max-width: 100%;
    }
    /* Make Video.js fluid & keep aspect */
    .video-js.vjs-fluid { padding-top: 56.25%; } /* 16:9 */
    /* Clamp height on very short landscapes to avoid overflow */
    @media (max-height: 420px) and (orientation: landscape) {
      .video-js { max-height: 70vh; }
    }

    /* Control block under the player */
    .controls {
      display: grid;
      gap: var(--gap);
      grid-template-columns: repeat(4, minmax(0, 1fr));
      margin-top: var(--pad);
    }
    .controls > * { width: 100%; }
    .controls select { width: 100%; }

    /* Stack nicely on narrower screens */
    @media (max-width: 900px) {
      .controls { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px) {
      .urlbar { grid-template-columns: 1fr; }
      .controls { grid-template-columns: 1fr; }
    }

    code { background:#1b1b1f; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <!-- <header class="wrap">
    <h1>Video.js — Responsive Web Player (Auto Detect)</h1>
    <small class="note">
      Paste a URL (<code>.m3u8</code>, <code>.mpd</code>, <code>.mp4</code>, etc.). Player is fully fluid and mobile-friendly.
    </small>
  </header> -->

  <main class="wrap card">
    <!-- URL input -->
    <div class="urlbar" role="group" aria-label="Load video by URL">
      <input id="urlInput" type="text" placeholder="Paste video URL… (m3u8 / mpd / mp4 / webm / ogg)" inputmode="url" />
      <button id="loadBtn" aria-label="Load video from URL">Load</button>
    </div>

    <!-- Player -->
    <div class="player-shell">
      <video
        id="vjs-player"
        class="video-js vjs-default-skin vjs-theme vjs-fluid"
        controls
        preload="auto"
        playsinline
        webkit-playsinline
        data-setup='{"responsive": true, "liveui": true, "html5": { "vhs": { "overrideNative": true }}}'>
        <source src="https://storage.googleapis.com/shaka-demo-assets/angel-one-hls/hls.m3u8" type="application/x-mpegURL" />
        <p class="vjs-no-js">
          To view this video please enable JavaScript and use a modern browser that supports HTML5 video.
        </p>
      </video>
    </div>

    <!-- Controls -->
    <div class="controls" style="margin-top: var(--pad)">
      <button data-type="application/x-mpegURL"
              data-src="https://storage.googleapis.com/shaka-demo-assets/angel-one-hls/hls.m3u8">Load HLS (M3U8)</button>

      <button data-type="application/dash+xml"
              data-src="https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd">Load DASH (MPD)</button>

      <button data-type="video/mp4"
              data-src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Load MP4</button>

      <select id="preloadSel" title="Preload">
        <option value="auto" selected>Preload: auto</option>
        <option value="metadata">Preload: metadata</option>
        <option value="none">Preload: none</option>
      </select>

      <button id="playBtn">▶️ Play</button>
      <button id="pauseBtn">⏸️ Pause</button>
      <button id="fsBtn">⛶ Fullscreen</button>
    </div>

    <!-- <small class="note" style="display:block; margin-top: var(--gap)">
      Tip: iOS Safari doesn’t support DASH (MPD), use HLS there. Some extensionless CDN URLs still work—player will try without an explicit type. Ensure CORS allows your origin.
    </small> -->
  </main>

  <!-- Video.js core JS (includes VHS for HLS/DASH) -->
  <script src="https://cdn.jsdelivr.net/npm/video.js@8/dist/video.min.js"></script>

  <!-- Optional: quality menu (uses Quality Levels + HTTP Source Selector) -->
  <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-quality-levels@3/dist/videojs-contrib-quality-levels.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-http-source-selector@1/dist/videojs-http-source-selector.min.js"></script>

  <script>
    const player = videojs('vjs-player');

    player.ready(function () {
      // Add a quality selector if available
      if (typeof player.httpSourceSelector === 'function') {
        player.httpSourceSelector({ default: 'auto' });
      }
      applyURLSourceFromQuery();
    });

    // Auto-detect MIME type from URL (same logic as before)
    function detectType(url) {
      try {
        const u = new URL(url, location.href);
        const path = (u.pathname || '').toLowerCase();
        const full = (u.href || '').toLowerCase();
        if (path.endsWith('.m3u8') || full.includes('m3u8')) return 'application/x-mpegURL';
        if (path.endsWith('.mpd')  || full.includes('/mpd')) return 'application/dash+xml';
        if (path.endsWith('.mp4'))  return 'video/mp4';
        if (path.endsWith('.webm')) return 'video/webm';
        if (path.endsWith('.ogv') || path.endsWith('.ogg')) return 'video/ogg';
        if (path.endsWith('.mov'))  return 'video/quicktime';
        if (path.endsWith('.m4v'))  return 'video/x-m4v';
        if (path.endsWith('.mkv'))  return 'video/x-matroska';
        return undefined;
      } catch {
        const s = (url || '').toLowerCase();
        if (s.includes('m3u8')) return 'application/x-mpegURL';
        if (s.includes('.mpd')) return 'application/dash+xml';
        if (s.endsWith('.mp4')) return 'video/mp4';
        if (s.endsWith('.webm')) return 'video/webm';
        if (s.endsWith('.ogg') || s.endsWith('.ogv')) return 'video/ogg';
        return undefined;
      }
    }

    function loadURL(url) {
      const type = detectType(url);
      player.pause();
      if (type) player.src({ src: url, type });
      else      player.src({ src: url });
      player.load();
      player.play().catch(()=>{});
    }

    // URL bar
    const urlInput = document.getElementById('urlInput');
    document.getElementById('loadBtn').onclick = () => {
      const url = urlInput.value.trim();
      if (!url) return alert('Please paste a video URL first.');
      loadURL(url);
    };
    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('loadBtn').click();
      }
    });

    // Preset buttons
    document.querySelectorAll('.controls button[data-src]').forEach(btn => {
      btn.addEventListener('click', () => {
        const src = btn.getAttribute('data-src');
        const type = btn.getAttribute('data-type') || detectType(src);
        player.pause();
        if (type) player.src({ src, type }); else player.src({ src });
        player.load();
        player.play().catch(()=>{});
        urlInput.value = src;
      });
    });

    // ?src= support (auto-detected type)
    function applyURLSourceFromQuery(){
      const params = new URLSearchParams(location.search);
      const src = params.get('src');
      if (src) {
        urlInput.value = src;
        loadURL(src);
      }
    }

    // Preload / transport controls
    document.getElementById('playBtn').onclick  = () => player.play();
    document.getElementById('pauseBtn').onclick = () => player.pause();
    document.getElementById('fsBtn').onclick    = () => player.requestFullscreen();
    document.getElementById('preloadSel').onchange = (e) => player.preload(e.target.value);

    // Error logging
    player.on('error', () => {
      const err = player.error();
      console.warn('Video.js error:', err);
      alert('Playback error: ' + (err && err.message ? err.message : 'Unknown'));
    });

    // Handle iOS notch safe areas a bit nicer
    document.documentElement.style.setProperty('--safe-bottom', (window.visualViewport && window.visualViewport.height < window.innerHeight) ? 'env(safe-area-inset-bottom)' : '0px');
  </script>
</body>
</html>
